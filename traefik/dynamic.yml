# This file configures Traefik's dynamic behavior, including middlewares and TLS certificates.

http:
  middlewares:
    # 1. Middleware to redirect all HTTP traffic to HTTPS
    https-redirect:
      redirectScheme:
        scheme: https
        permanent: true

    # 2. Merged secure headers from both configurations
    secure-headers:
      headers:
        forceSTSHeader: true
        stsIncludeSubdomains: true
        stsPreload: true
        stsSeconds: 31536000
        customFrameOptionsValue: "SAMEORIGIN"
        contentTypeNosniff: true
        browserXssFilter: true

    # 3. Rate limiting from your existing configuration
    rate-limit:
      rateLimit:
        average: 100
        burst: 50

    # 4. IP whitelist for internal services (from your existing config)
    # internal-only:
    #   ipWhiteList:
    #     sourceRange:
    #       - "192.168.1.0/24"
    #       - "10.0.0.0/8"
    #       - "172.16.0.0/12"

# 5. Your advanced TLS configuration
tls:
  certificates:
    - certFile: /etc/traefik/certs/origin-cert.pem
      keyFile: /etc/traefik/certs/origin-key.pem
      stores:
        - default

  stores:
    default:
      defaultCertificate:
        certFile: /etc/traefik/certs/origin-cert.pem
        keyFile: /etc/traefik/certs/origin-key.pem

  options:
    default:
      minVersion: VersionTLS12
      cipherSuites:
        - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
        - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
        - TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305

