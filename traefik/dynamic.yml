# This file configures Traefik's dynamic behavior, including middlewares and TLS certificates.

http:
  middlewares:
    # 1. Middleware to redirect all HTTP traffic to HTTPS (disabled for Cloudflare Tunnel)
    https-redirect:
      redirectScheme:
        scheme: https
        permanent: true

    # 1b. Middleware for Cloudflare Tunnel - no HTTPS redirect needed (Cloudflare handles it)
    https-redirect-cf:
      redirectScheme:
        scheme: http
        permanent: false

    # 2. Merged secure headers from both configurations
    secure-headers:
      headers:
        forceSTSHeader: true
        stsIncludeSubdomains: true
        stsPreload: true
        stsSeconds: 31536000
        customFrameOptionsValue: "SAMEORIGIN"
        contentTypeNosniff: true
        browserXssFilter: true

    # 3. Rate limiting from your existing configuration
    rate-limit:
      rateLimit:
        average: 100
        burst: 50

    # 4. IP whitelist for internal services (from your existing config)
    # internal-only:
    #   ipWhiteList:
    #     sourceRange:
    #       - "192.168.1.0/24"
    #       - "10.0.0.0/8"
    #       - "172.16.0.0/12"

    # 5. Basic authentication for Traefik dashboard
    traefik-auth:
      basicAuth:
        users:
          - "Hunt3rJake:$2b$12$9qkdg9IGZJResMTIh64zNOAhMTMfnfwXuemLPdgl9ugxkcLUrYZei"

# 5. TLS configuration - using ACME Let's Encrypt
tls:
  options:
    default:
      minVersion: VersionTLS12
      cipherSuites:
        - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
        - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
        - TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305

